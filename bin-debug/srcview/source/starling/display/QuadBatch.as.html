<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>QuadBatch.as</title>
<link rel="stylesheet" type="text/css" href="../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">// =================================================================================================
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">//    Starling Framework
</span><span class="ActionScriptComment">//    Copyright 2012 Gamua OG. All Rights Reserved.
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">//    This program is free software. You can redistribute and/or modify it
</span><span class="ActionScriptComment">//    in accordance with the terms of the accompanying license agreement.
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">// =================================================================================================
</span>
<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Context3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Context3DProgramType</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Context3DTextureFormat</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Context3DVertexBufferFormat</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IndexBuffer3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Program3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">VertexBuffer3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Matrix</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Matrix3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Rectangle</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Dictionary</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getQualifiedClassName</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RenderSupport</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Starling</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">starling_internal</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">errors</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MissingContextError</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Event</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">filters</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FragmentFilter</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">filters</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FragmentFilterMode</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">textures</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Texture</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">textures</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TextureSmoothing</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MatrixUtil</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">VertexData</span>;
    
    <span class="ActionScriptReserved">use</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptDefault_Text">starling_internal</span>;
    
    <span class="ActionScriptASDoc">/** Optimizes rendering of a number of quads with an identical state.
     * 
     *  &lt;p&gt;The majority of all rendered objects in Starling are quads. In fact, all the default
     *  leaf nodes of Starling are quads (the Image and Quad classes). The rendering of those 
     *  quads can be accelerated by a big factor if all quads with an identical state are sent 
     *  to the GPU in just one call. That's what the QuadBatch class can do.&lt;/p&gt;
     *  
     *  &lt;p&gt;The 'flatten' method of the Sprite class uses this class internally to optimize its 
     *  rendering performance. In most situations, it is recommended to stick with flattened
     *  sprites, because they are easier to use. Sometimes, however, it makes sense
     *  to use the QuadBatch class directly: e.g. you can add one quad multiple times to 
     *  a quad batch, whereas you can only add it once to a sprite. Furthermore, this class
     *  does not dispatch &lt;code&gt;ADDED&lt;/code&gt; or &lt;code&gt;ADDED_TO_STAGE&lt;/code&gt; events when a quad
     *  is added, which makes it more lightweight.&lt;/p&gt;
     *  
     *  &lt;p&gt;One QuadBatch object is bound to a specific render state. The first object you add to a 
     *  batch will decide on the QuadBatch's state, that is: its texture, its settings for 
     *  smoothing and blending, and if it's tinted (colored vertices and/or transparency). 
     *  When you reset the batch, it will accept a new state on the next added quad.&lt;/p&gt; 
     *  
     *  &lt;p&gt;The class extends DisplayObject, but you can use it even without adding it to the
     *  display tree. Just call the 'renderCustom' method from within another render method,
     *  and pass appropriate values for transformation matrix, alpha and blend mode.&lt;/p&gt;
     *
     *  @see Sprite  
     */</span> 
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">QuadBatch</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">DisplayObject</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptASDoc">/** The maximum number of quads that can be displayed by one QuadBatch. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MAX_NUM_QUADS</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 16383;
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">QUAD_PROGRAM_NAME</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"QB_q"</span>;
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mNumQuads</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mSyncRequired</span>:<span class="ActionScriptDefault_Text">Boolean</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mBatchable</span>:<span class="ActionScriptDefault_Text">Boolean</span>;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mTinted</span>:<span class="ActionScriptDefault_Text">Boolean</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mTexture</span>:<span class="ActionScriptDefault_Text">Texture</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mSmoothing</span>:<span class="ActionScriptDefault_Text">String</span>;
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mVertexBuffer</span>:<span class="ActionScriptDefault_Text">VertexBuffer3D</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mIndexData</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">&gt;</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mIndexBuffer</span>:<span class="ActionScriptDefault_Text">IndexBuffer3D</span>;
        
        <span class="ActionScriptASDoc">/** The raw vertex data of the quad. After modifying its contents, call
         *  'onVertexDataChanged' to upload the changes to the vertex buffers. Don't change the
         *  size of this object manually; instead, use the 'capacity' property of the QuadBatch. */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mVertexData</span>:<span class="ActionScriptDefault_Text">VertexData</span>;

        <span class="ActionScriptASDoc">/** Helper objects. */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sHelperMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sRenderAlpha</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptBracket/Brace">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">[</span>1.0<span class="ActionScriptOperator">,</span> 1.0<span class="ActionScriptOperator">,</span> 1.0<span class="ActionScriptOperator">,</span> 1.0<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sRenderMatrix</span>:<span class="ActionScriptDefault_Text">Matrix3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sProgramNameCache</span>:<span class="ActionScriptDefault_Text">Dictionary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptASDoc">/** Creates a new QuadBatch instance with empty batch data. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">QuadBatch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">mVertexData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">VertexData</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">mIndexData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptBracket/Brace">&lt;</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">&gt;</span>[];
            <span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">mTinted</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptDefault_Text">mSyncRequired</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptDefault_Text">mBatchable</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            
            <span class="ActionScriptComment">// Handle lost context. We use the conventional event here (not the one from Starling)
</span>            <span class="ActionScriptComment">// so we're able to create a weak event listener; this avoids memory leaks when people 
</span>            <span class="ActionScriptComment">// forget to call "dispose" on the QuadBatch.
</span>            <span class="ActionScriptDefault_Text">Starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">current</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stage3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CONTEXT3D_CREATE</span><span class="ActionScriptOperator">,</span> 
                                                      <span class="ActionScriptDefault_Text">onContextCreated</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Disposes vertex- and index-buffer. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">Starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">current</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stage3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CONTEXT3D_CREATE</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onContextCreated</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">destroyBuffers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">numVertices</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">mIndexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onContextCreated</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">createBuffers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Call this method after manually changing the contents of 'mVertexData'. */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onVertexDataChanged</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">mSyncRequired</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Creates a duplicate of the QuadBatch object. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">QuadBatch</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">clone</span>:<span class="ActionScriptDefault_Text">QuadBatch</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">QuadBatch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mVertexData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">*</span> 4<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mIndexData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mIndexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">slice</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">*</span> 6<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mNumQuads</span>;
            <span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mTinted</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mTinted</span>;
            <span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mTexture</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mTexture</span>;
            <span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mSmoothing</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mSmoothing</span>;
            <span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mSyncRequired</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">blendMode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">blendMode</span>;
            <span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">alpha</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">alpha</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">clone</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">expand</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">oldCapacity</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">capacity</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">capacity</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">oldCapacity</span> <span class="ActionScriptOperator">&lt;</span> 8 <span class="ActionScriptOperator">?</span> 16 : <span class="ActionScriptDefault_Text">oldCapacity</span> <span class="ActionScriptOperator">*</span> 2;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createBuffers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">destroyBuffers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">numVertices</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">numVertices</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">numIndices</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mIndexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">context</span>:<span class="ActionScriptDefault_Text">Context3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">context</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">numVertices</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">context</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>  <span class="ActionScriptReserved">throw</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MissingContextError</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">mVertexBuffer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">createVertexBuffer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">numVertices</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">VertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ELEMENTS_PER_VERTEX</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">mVertexBuffer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">uploadFromVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">numVertices</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">mIndexBuffer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">createIndexBuffer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">numIndices</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">mIndexBuffer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">uploadFromVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mIndexData</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">numIndices</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">mSyncRequired</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">destroyBuffers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mVertexBuffer</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">mVertexBuffer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">mVertexBuffer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mIndexBuffer</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">mIndexBuffer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">mIndexBuffer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/** Uploads the raw data of all batched quads to the vertex buffer. */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">syncBuffers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mVertexBuffer</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">createBuffers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// as last parameter, we could also use 'mNumQuads * 4', but on some
</span>                <span class="ActionScriptComment">// GPU hardware (iOS!), this is slower than updating the complete buffer.
</span>                <span class="ActionScriptDefault_Text">mVertexBuffer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">uploadFromVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">numVertices</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">mSyncRequired</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Renders the current batch with custom settings for model-view-projection matrix, alpha 
         *  and blend mode. This makes it possible to render batches that are not part of the 
         *  display list. */</span> 
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">renderCustom</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mvpMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">parentAlpha</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1.0<span class="ActionScriptOperator">,</span>
                                     <span class="ActionScriptDefault_Text">blendMode</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mSyncRequired</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">syncBuffers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pma</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">premultipliedAlpha</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">context</span>:<span class="ActionScriptDefault_Text">Context3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">context</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tinted</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mTinted</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentAlpha</span> <span class="ActionScriptOperator">!=</span> 1.0<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">sRenderAlpha</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sRenderAlpha</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sRenderAlpha</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pma</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">parentAlpha</span> : 1.0;
            <span class="ActionScriptDefault_Text">sRenderAlpha</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parentAlpha</span>;
            
            <span class="ActionScriptDefault_Text">MatrixUtil</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">convertTo3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mvpMatrix</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">sRenderMatrix</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">RenderSupport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setBlendFactors</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pma</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">blendMode</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">blendMode</span> : <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">blendMode</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">getProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tinted</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setProgramConstantsFromVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Context3DProgramType</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">VERTEX</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">sRenderAlpha</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setProgramConstantsFromMatrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Context3DProgramType</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">VERTEX</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">sRenderMatrix</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setVertexBufferAt</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mVertexBuffer</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">VertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">POSITION_OFFSET</span><span class="ActionScriptOperator">,</span> 
                                      <span class="ActionScriptDefault_Text">Context3DVertexBufferFormat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FLOAT_2</span><span class="ActionScriptBracket/Brace">)</span>; 
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mTexture</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">tinted</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setVertexBufferAt</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mVertexBuffer</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">VertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">COLOR_OFFSET</span><span class="ActionScriptOperator">,</span> 
                                          <span class="ActionScriptDefault_Text">Context3DVertexBufferFormat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FLOAT_4</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mTexture</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setTextureAt</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">base</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setVertexBufferAt</span><span class="ActionScriptBracket/Brace">(</span>2<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mVertexBuffer</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">VertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TEXCOORD_OFFSET</span><span class="ActionScriptOperator">,</span> 
                                          <span class="ActionScriptDefault_Text">Context3DVertexBufferFormat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FLOAT_2</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawTriangles</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mIndexBuffer</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">*</span> 2<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mTexture</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setTextureAt</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setVertexBufferAt</span><span class="ActionScriptBracket/Brace">(</span>2<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setVertexBufferAt</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setVertexBufferAt</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Resets the batch. The vertex- and index-buffers remain their size, so that they
         *  can be reused quickly. */</span>  
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">reset</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">mTexture</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">mSmoothing</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">mSyncRequired</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Adds an image to the batch. This method internally calls 'addQuad' with the correct
         *  parameters for 'texture' and 'smoothing'. */</span> 
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addImage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">image</span>:<span class="ActionScriptDefault_Text">Image</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">parentAlpha</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1.0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">modelViewMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span>
                                 <span class="ActionScriptDefault_Text">blendMode</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">addQuad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">image</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">parentAlpha</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">image</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">texture</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">image</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">smoothing</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">modelViewMatrix</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">blendMode</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Adds a quad to the batch. The first quad determines the state of the batch,
         *  i.e. the values for texture, smoothing and blendmode. When you add additional quads,  
         *  make sure they share that state (e.g. with the 'isStateChange' method), or reset
         *  the batch. */</span> 
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addQuad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quad</span>:<span class="ActionScriptDefault_Text">Quad</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">parentAlpha</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1.0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">texture</span>:<span class="ActionScriptDefault_Text">Texture</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> 
                                <span class="ActionScriptDefault_Text">smoothing</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">modelViewMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> 
                                <span class="ActionScriptDefault_Text">blendMode</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">modelViewMatrix</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">modelViewMatrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">quad</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformationMatrix</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">alpha</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parentAlpha</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">quad</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">alpha</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vertexID</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">*</span> 4;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">+</span> 1 <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">numVertices</span> <span class="ActionScriptOperator">/</span> 4<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">expand</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">blendMode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">blendMode</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">blendMode</span> : <span class="ActionScriptDefault_Text">quad</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">blendMode</span>;
                <span class="ActionScriptDefault_Text">mTexture</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">texture</span>;
                <span class="ActionScriptDefault_Text">mTinted</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">texture</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quad</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tinted</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">parentAlpha</span> <span class="ActionScriptOperator">!=</span> 1.0<span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptDefault_Text">mSmoothing</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">smoothing</span>;
                <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setPremultipliedAlpha</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quad</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">premultipliedAlpha</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">quad</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">copyVertexDataTransformedTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">vertexID</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">modelViewMatrix</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">alpha</span> <span class="ActionScriptOperator">!=</span> 1.0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">scaleAlpha</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertexID</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptOperator">,</span> 4<span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">mSyncRequired</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptDefault_Text">mNumQuads</span><span class="ActionScriptOperator">++</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Adds another QuadBatch to this batch. Just like the 'addQuad' method, you have to
         *  make sure that you only add batches with an equal state. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addQuadBatch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadBatch</span>:<span class="ActionScriptDefault_Text">QuadBatch</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">parentAlpha</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1.0<span class="ActionScriptOperator">,</span> 
                                     <span class="ActionScriptDefault_Text">modelViewMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">blendMode</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">modelViewMatrix</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">modelViewMatrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">quadBatch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformationMatrix</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tinted</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">quadBatch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mTinted</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">parentAlpha</span> <span class="ActionScriptOperator">!=</span> 1.0;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">alpha</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parentAlpha</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">quadBatch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">alpha</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vertexID</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">*</span> 4;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">numQuads</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">quadBatch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">numQuads</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">numQuads</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">capacity</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">capacity</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">numQuads</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">blendMode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">blendMode</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">blendMode</span> : <span class="ActionScriptDefault_Text">quadBatch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">blendMode</span>;
                <span class="ActionScriptDefault_Text">mTexture</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">quadBatch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mTexture</span>;
                <span class="ActionScriptDefault_Text">mTinted</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tinted</span>;
                <span class="ActionScriptDefault_Text">mSmoothing</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">quadBatch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mSmoothing</span>;
                <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setPremultipliedAlpha</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadBatch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">premultipliedAlpha</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">quadBatch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">copyTransformedTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">vertexID</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">modelViewMatrix</span><span class="ActionScriptOperator">,</span>
                                                    0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">numQuads</span><span class="ActionScriptOperator">*</span>4<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">alpha</span> <span class="ActionScriptOperator">!=</span> 1.0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">scaleAlpha</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertexID</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">numQuads</span><span class="ActionScriptOperator">*</span>4<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">mSyncRequired</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">numQuads</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Indicates if specific quads can be added to the batch without causing a state change. 
         *  A state change occurs if the quad uses a different base texture, has a different 
         *  'tinted', 'smoothing', 'repeat' or 'blendMode' setting, or if the batch is full
         *  (one batch can contain up to 8192 quads). */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">isStateChange</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tinted</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">parentAlpha</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">texture</span>:<span class="ActionScriptDefault_Text">Texture</span><span class="ActionScriptOperator">,</span> 
                                      <span class="ActionScriptDefault_Text">smoothing</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">blendMode</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">numQuads</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>1<span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">numQuads</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">MAX_NUM_QUADS</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>; <span class="ActionScriptComment">// maximum buffer size
</span>            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mTexture</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">texture</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> 
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">blendMode</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">blendMode</span>;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mTexture</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">texture</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">base</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">texture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">base</span> <span class="ActionScriptOperator">||</span>
                       <span class="ActionScriptDefault_Text">mTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">repeat</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">texture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">repeat</span> <span class="ActionScriptOperator">||</span>
                       <span class="ActionScriptDefault_Text">mSmoothing</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">smoothing</span> <span class="ActionScriptOperator">||</span>
                       <span class="ActionScriptDefault_Text">mTinted</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tinted</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">parentAlpha</span> <span class="ActionScriptOperator">!=</span> 1.0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span>
                       <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">blendMode</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">blendMode</span>;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// utility methods for manual vertex-modification
</span>        
        <span class="ActionScriptASDoc">/** Transforms the vertices of a certain quad by the given matrix. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">transformQuad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">matrix</span>:<span class="ActionScriptDefault_Text">Matrix</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformVertex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span> <span class="ActionScriptOperator">*</span> 4<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">matrix</span><span class="ActionScriptOperator">,</span> 4<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">mSyncRequired</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Returns the color of one vertex of a specific quad. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getVertexColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">vertexID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">uint</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span> <span class="ActionScriptOperator">*</span> 4 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vertexID</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Updates the color of one vertex of a specific quad. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setVertexColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">vertexID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">color</span>:<span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span> <span class="ActionScriptOperator">*</span> 4 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vertexID</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">color</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">mSyncRequired</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Returns the alpha value of one vertex of a specific quad. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getVertexAlpha</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">vertexID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getAlpha</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span> <span class="ActionScriptOperator">*</span> 4 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vertexID</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Updates the alpha value of one vertex of a specific quad. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setVertexAlpha</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">vertexID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">alpha</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setAlpha</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span> <span class="ActionScriptOperator">*</span> 4 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vertexID</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">mSyncRequired</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Returns the color of the first vertex of a specific quad. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getQuadColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">uint</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span> <span class="ActionScriptOperator">*</span> 4<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Updates the color of a specific quad. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setQuadColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">color</span>:<span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span>4; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span> <span class="ActionScriptOperator">*</span> 4 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">color</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">mSyncRequired</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Returns the alpha value of the first vertex of a specific quad. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getQuadAlpha</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getAlpha</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span> <span class="ActionScriptOperator">*</span> 4<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Updates the alpha value of a specific quad. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setQuadAlpha</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">alpha</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span>4; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setAlpha</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span> <span class="ActionScriptOperator">*</span> 4 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">mSyncRequired</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Calculates the bounds of a specific quad, optionally transformed by a matrix.
         *  If you pass a 'resultRect', the result will be stored in this rectangle
         *  instead of creating a new object. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getQuadBounds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">transformationMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span>
                                      <span class="ActionScriptDefault_Text">resultRect</span>:<span class="ActionScriptDefault_Text">Rectangle</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Rectangle</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getBounds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">transformationMatrix</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">quadID</span> <span class="ActionScriptOperator">*</span> 4<span class="ActionScriptOperator">,</span> 4<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">resultRect</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// display object methods
</span>        
        <span class="ActionScriptASDoc">/** @inheritDoc */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getBounds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">targetSpace</span>:<span class="ActionScriptDefault_Text">DisplayObject</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">resultRect</span>:<span class="ActionScriptDefault_Text">Rectangle</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Rectangle</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">resultRect</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">resultRect</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Rectangle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">transformationMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">targetSpace</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">this</span> <span class="ActionScriptOperator">?</span>
                <span class="ActionScriptReserved">null</span> : <span class="ActionScriptDefault_Text">getTransformationMatrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">targetSpace</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">sHelperMatrix</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getBounds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">transformationMatrix</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mNumQuads</span><span class="ActionScriptOperator">*</span>4<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">resultRect</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** @inheritDoc */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">render</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">support</span>:<span class="ActionScriptDefault_Text">RenderSupport</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">parentAlpha</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mNumQuads</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mBatchable</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">support</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">batchQuadBatch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">parentAlpha</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">support</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">finishQuadBatch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">support</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">raiseDrawCount</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">renderCustom</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">support</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mvpMatrix</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">alpha</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">parentAlpha</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">support</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">blendMode</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// compilation (for flattened sprites)
</span>        
        <span class="ActionScriptASDoc">/** Analyses an object that is made up exclusively of quads (or other containers)
         *  and creates a vector of QuadBatch objects representing it. This can be
         *  used to render the container very efficiently. The 'flatten'-method of the Sprite 
         *  class uses this method internally. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">compile</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">DisplayObject</span><span class="ActionScriptOperator">,</span> 
                                       <span class="ActionScriptDefault_Text">quadBatches</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">QuadBatch</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">compileObject</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">quadBatches</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">compileObject</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">DisplayObject</span><span class="ActionScriptOperator">,</span> 
                                              <span class="ActionScriptDefault_Text">quadBatches</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">QuadBatch</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span>
                                              <span class="ActionScriptDefault_Text">quadBatchID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span>
                                              <span class="ActionScriptDefault_Text">transformationMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span><span class="ActionScriptOperator">,</span>
                                              <span class="ActionScriptDefault_Text">alpha</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1.0<span class="ActionScriptOperator">,</span>
                                              <span class="ActionScriptDefault_Text">blendMode</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span>
                                              <span class="ActionScriptDefault_Text">ignoreCurrentFilter</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">quadBatch</span>:<span class="ActionScriptDefault_Text">QuadBatch</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">isRootObject</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">objectAlpha</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">alpha</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">container</span>:<span class="ActionScriptDefault_Text">DisplayObjectContainer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">object</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">DisplayObjectContainer</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">quad</span>:<span class="ActionScriptDefault_Text">Quad</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">object</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Quad</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">batch</span>:<span class="ActionScriptDefault_Text">QuadBatch</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">object</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">QuadBatch</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">filter</span>:<span class="ActionScriptDefault_Text">FragmentFilter</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">filter</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadBatchID</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">isRootObject</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">quadBatchID</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptDefault_Text">objectAlpha</span> <span class="ActionScriptOperator">=</span> 1.0;
                <span class="ActionScriptDefault_Text">blendMode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">blendMode</span>;
                <span class="ActionScriptDefault_Text">ignoreCurrentFilter</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadBatches</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">quadBatches</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">QuadBatch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptDefault_Text">quadBatches</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">reset</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">filter</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">ignoreCurrentFilter</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">filter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mode</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">FragmentFilterMode</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ABOVE</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">quadBatchID</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">compileObject</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">quadBatches</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">quadBatchID</span><span class="ActionScriptOperator">,</span>
                                                <span class="ActionScriptDefault_Text">transformationMatrix</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">blendMode</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">quadBatchID</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">compileObject</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">filter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">compile</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">quadBatches</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">quadBatchID</span><span class="ActionScriptOperator">,</span>
                                            <span class="ActionScriptDefault_Text">transformationMatrix</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">blendMode</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">filter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mode</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">FragmentFilterMode</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BELOW</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">quadBatchID</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">compileObject</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">quadBatches</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">quadBatchID</span><span class="ActionScriptOperator">,</span>
                        <span class="ActionScriptDefault_Text">transformationMatrix</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">blendMode</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">container</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">numChildren</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">numChildren</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">childMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">numChildren</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">child</span>:<span class="ActionScriptDefault_Text">DisplayObject</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getChildAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasVisibleArea</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">childBlendMode</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">blendMode</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">BlendMode</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">AUTO</span> <span class="ActionScriptOperator">?</span>
                                                    <span class="ActionScriptDefault_Text">blendMode</span> : <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">blendMode</span>;
                        <span class="ActionScriptDefault_Text">childMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">copyFrom</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">transformationMatrix</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">RenderSupport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformMatrixForObject</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">childMatrix</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">quadBatchID</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">compileObject</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">quadBatches</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">quadBatchID</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">childMatrix</span><span class="ActionScriptOperator">,</span> 
                                                    <span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">objectAlpha</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">childBlendMode</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quad</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">batch</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">texture</span>:<span class="ActionScriptDefault_Text">Texture</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">smoothing</span>:<span class="ActionScriptDefault_Text">String</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tinted</span>:<span class="ActionScriptDefault_Text">Boolean</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">numQuads</span>:<span class="ActionScriptDefault_Text">int</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quad</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">image</span>:<span class="ActionScriptDefault_Text">Image</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">quad</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Image</span>;
                    <span class="ActionScriptDefault_Text">texture</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">image</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">image</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">texture</span> : <span class="ActionScriptReserved">null</span>;
                    <span class="ActionScriptDefault_Text">smoothing</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">image</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">image</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">smoothing</span> : <span class="ActionScriptReserved">null</span>;
                    <span class="ActionScriptDefault_Text">tinted</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">quad</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tinted</span>;
                    <span class="ActionScriptDefault_Text">numQuads</span> <span class="ActionScriptOperator">=</span> 1;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">texture</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">batch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mTexture</span>;
                    <span class="ActionScriptDefault_Text">smoothing</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">batch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mSmoothing</span>;
                    <span class="ActionScriptDefault_Text">tinted</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">batch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mTinted</span>;
                    <span class="ActionScriptDefault_Text">numQuads</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">batch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mNumQuads</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">quadBatch</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">quadBatches</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">quadBatchID</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadBatch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isStateChange</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tinted</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">objectAlpha</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">texture</span><span class="ActionScriptOperator">,</span> 
                                            <span class="ActionScriptDefault_Text">smoothing</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">blendMode</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">numQuads</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">quadBatchID</span><span class="ActionScriptOperator">++</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quadBatches</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptDefault_Text">quadBatchID</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">quadBatches</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">QuadBatch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">quadBatch</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">quadBatches</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">quadBatchID</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">quadBatch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">reset</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quad</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">quadBatch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addQuad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quad</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">texture</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">smoothing</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">transformationMatrix</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">blendMode</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptDefault_Text">quadBatch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addQuadBatch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">batch</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">transformationMatrix</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">blendMode</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"Unsupported display object: "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">getQualifiedClassName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isRootObject</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// remove unused batches
</span>                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">quadBatches</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span>1; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptDefault_Text">quadBatchID</span>; <span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">quadBatches</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">quadBatchID</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// properties
</span>        
        <span class="ActionScriptASDoc">/** Returns the number of quads that have been added to the batch. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">numQuads</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mNumQuads</span>; <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Indicates if any vertices have a non-white color or are not fully opaque. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">tinted</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mTinted</span>; <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** The texture that is used for rendering, or null for pure quads. Note that this is the
         *  texture instance of the first added quad; subsequently added quads may use a different
         *  instance, as long as the base texture is the same. */</span> 
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">texture</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Texture</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mTexture</span>; <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** The TextureSmoothing used for rendering. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">smoothing</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mSmoothing</span>; <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Indicates if the rgb values are stored premultiplied with the alpha value. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">premultipliedAlpha</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">premultipliedAlpha</span>; <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Indicates if the batch itself should be batched on rendering. This makes sense only
         *  if it contains only a small number of quads (we recommend no more than 16). Otherwise,
         *  the CPU costs will exceed any gains you get from avoiding the additional draw call.
         *  @default false */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">batchable</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mBatchable</span>; <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">batchable</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptDefault_Text">mBatchable</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>; <span class="ActionScriptBracket/Brace">}</span> 
        
        <span class="ActionScriptASDoc">/** Indicates the number of quads for which space is allocated (vertex- and index-buffers).
         *  If you add more quads than what fits into the current capacity, the QuadBatch is
         *  expanded automatically. However, if you know beforehand how many vertices you need,
         *  you can manually set the right capacity with this method. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">capacity</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">numVertices</span> <span class="ActionScriptOperator">/</span> 4; <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">capacity</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">oldCapacity</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">capacity</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">oldCapacity</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">throw</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"Capacity must be &gt; 0"</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">MAX_NUM_QUADS</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">MAX_NUM_QUADS</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">mNumQuads</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
            
            <span class="ActionScriptDefault_Text">mVertexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">numVertices</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">*</span> 4;
            <span class="ActionScriptDefault_Text">mIndexData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">*</span> 6;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">oldCapacity</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">value</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">mIndexData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>6  <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>4;
                <span class="ActionScriptDefault_Text">mIndexData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>6<span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>4 <span class="ActionScriptOperator">+</span> 1;
                <span class="ActionScriptDefault_Text">mIndexData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>6<span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>4 <span class="ActionScriptOperator">+</span> 2;
                <span class="ActionScriptDefault_Text">mIndexData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>6<span class="ActionScriptOperator">+</span>3<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>4 <span class="ActionScriptOperator">+</span> 1;
                <span class="ActionScriptDefault_Text">mIndexData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>6<span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>4 <span class="ActionScriptOperator">+</span> 3;
                <span class="ActionScriptDefault_Text">mIndexData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>6<span class="ActionScriptOperator">+</span>5<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>4 <span class="ActionScriptOperator">+</span> 2;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptDefault_Text">destroyBuffers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">mSyncRequired</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptComment">// program management
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tinted</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Program3D</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">target</span>:<span class="ActionScriptDefault_Text">Starling</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">current</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">programName</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">QUAD_PROGRAM_NAME</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mTexture</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">programName</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getImageProgramName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tinted</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mipMapping</span><span class="ActionScriptOperator">,</span> 
                    <span class="ActionScriptDefault_Text">mTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">repeat</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">format</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mSmoothing</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">program</span>:<span class="ActionScriptDefault_Text">Program3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">target</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">programName</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">program</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// this is the input data we'll pass to the shaders:
</span>                <span class="ActionScriptComment">// 
</span>                <span class="ActionScriptComment">// va0 -&gt; position
</span>                <span class="ActionScriptComment">// va1 -&gt; color
</span>                <span class="ActionScriptComment">// va2 -&gt; texCoords
</span>                <span class="ActionScriptComment">// vc0 -&gt; alpha
</span>                <span class="ActionScriptComment">// vc1 -&gt; mvpMatrix
</span>                <span class="ActionScriptComment">// fs0 -&gt; texture
</span>                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vertexShader</span>:<span class="ActionScriptDefault_Text">String</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fragmentShader</span>:<span class="ActionScriptDefault_Text">String</span>;

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">mTexture</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptComment">// Quad-Shaders
</span>                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">vertexShader</span> <span class="ActionScriptOperator">=</span>
                        <span class="ActionScriptString">"m44 op, va0, vc1 \n"</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptComment">// 4x4 matrix transform to output clipspace
</span>                        <span class="ActionScriptString">"mul v0, va1, vc0 \n"</span>;  <span class="ActionScriptComment">// multiply alpha (vc0) with color (va1)
</span>                    
                    <span class="ActionScriptDefault_Text">fragmentShader</span> <span class="ActionScriptOperator">=</span>
                        <span class="ActionScriptString">"mov oc, v0       \n"</span>;  <span class="ActionScriptComment">// output color
</span>                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptComment">// Image-Shaders
</span>                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">vertexShader</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tinted</span> <span class="ActionScriptOperator">?</span>
                        <span class="ActionScriptString">"m44 op, va0, vc1 \n"</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptComment">// 4x4 matrix transform to output clipspace
</span>                        <span class="ActionScriptString">"mul v0, va1, vc0 \n"</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptComment">// multiply alpha (vc0) with color (va1)
</span>                        <span class="ActionScriptString">"mov v1, va2      \n"</span>   <span class="ActionScriptComment">// pass texture coordinates to fragment program
</span>                        :
                        <span class="ActionScriptString">"m44 op, va0, vc1 \n"</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptComment">// 4x4 matrix transform to output clipspace
</span>                        <span class="ActionScriptString">"mov v1, va2      \n"</span>;  <span class="ActionScriptComment">// pass texture coordinates to fragment program
</span>                    
                    <span class="ActionScriptDefault_Text">fragmentShader</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tinted</span> <span class="ActionScriptOperator">?</span>
                        <span class="ActionScriptString">"tex ft1,  v1, fs0 &lt;???&gt; \n"</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptComment">// sample texture 0
</span>                        <span class="ActionScriptString">"mul  oc, ft1,  v0       \n"</span>   <span class="ActionScriptComment">// multiply color with texel color
</span>                        :
                        <span class="ActionScriptString">"tex  oc,  v1, fs0 &lt;???&gt; \n"</span>;  <span class="ActionScriptComment">// sample texture 0
</span>                    
                    <span class="ActionScriptDefault_Text">fragmentShader</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fragmentShader</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"&lt;???&gt;"</span><span class="ActionScriptOperator">,</span>
                        <span class="ActionScriptDefault_Text">RenderSupport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getTextureLookupFlags</span><span class="ActionScriptBracket/Brace">(</span>
                            <span class="ActionScriptDefault_Text">mTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">format</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mipMapping</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">repeat</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">smoothing</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">program</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">target</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">registerProgramFromSource</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">programName</span><span class="ActionScriptOperator">,</span>
                    <span class="ActionScriptDefault_Text">vertexShader</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">fragmentShader</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">program</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getImageProgramName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tinted</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mipMap</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span><span class="ActionScriptOperator">,</span> 
                                                    <span class="ActionScriptDefault_Text">repeat</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">format</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"bgra"</span><span class="ActionScriptOperator">,</span>
                                                    <span class="ActionScriptDefault_Text">smoothing</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"bilinear"</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bitField</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tinted</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">bitField</span> <span class="ActionScriptOperator">|=</span> 1;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mipMap</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">bitField</span> <span class="ActionScriptOperator">|=</span> 1 <span class="ActionScriptOperator">&lt;&lt;</span> 1;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">repeat</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">bitField</span> <span class="ActionScriptOperator">|=</span> 1 <span class="ActionScriptOperator">&lt;&lt;</span> 2;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">smoothing</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">TextureSmoothing</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">NONE</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">bitField</span> <span class="ActionScriptOperator">|=</span> 1 <span class="ActionScriptOperator">&lt;&lt;</span> 3;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">smoothing</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">TextureSmoothing</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TRILINEAR</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">bitField</span> <span class="ActionScriptOperator">|=</span> 1 <span class="ActionScriptOperator">&lt;&lt;</span> 4;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">format</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">Context3DTextureFormat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">COMPRESSED</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">bitField</span> <span class="ActionScriptOperator">|=</span> 1 <span class="ActionScriptOperator">&lt;&lt;</span> 5;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">format</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">"compressedAlpha"</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">bitField</span> <span class="ActionScriptOperator">|=</span> 1 <span class="ActionScriptOperator">&lt;&lt;</span> 6;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">name</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sProgramNameCache</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">bitField</span><span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"QB_i."</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bitField</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span>16<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">sProgramNameCache</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">bitField</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">name</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">name</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
