<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>TouchProcessor.as</title>
<link rel="stylesheet" type="text/css" href="../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">// =================================================================================================
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">//    Starling Framework
</span><span class="ActionScriptComment">//    Copyright 2011 Gamua OG. All Rights Reserved.
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">//    This program is free software. You can redistribute and/or modify it
</span><span class="ActionScriptComment">//    in accordance with the terms of the accompanying license agreement.
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">// =================================================================================================
</span>
<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Point</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getDefinitionByName</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">DisplayObject</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Stage</span>;

    <span class="ActionScriptASDoc">/** The TouchProcessor is used to convert mouse and touch events of the conventional
     *  Flash stage to Starling's TouchEvents.
     *  
     *  &lt;p&gt;The Starling instance listens to mouse and touch events on the native stage. The
     *  attributes of those events are enqueued (right as they are happening) in the
     *  TouchProcessor.&lt;/p&gt;
     *  
     *  &lt;p&gt;Once per frame, the "advanceTime" method is called. It analyzes the touch queue and
     *  figures out which touches are active at that moment; the properties of all touch objects
     *  are updated accordingly.&lt;/p&gt;
     *  
     *  &lt;p&gt;Once the list of touches has been finalized, the "processTouches" method is called
     *  (that might happen several times in one "advanceTime" execution; no information is
     *  discarded). It's responsible for dispatching the actual touch events to the Starling
     *  display tree.&lt;/p&gt;
     *  
     *  &lt;strong&gt;Subclassing TouchProcessor&lt;/strong&gt;
     *  
     *  &lt;p&gt;You can extend the TouchProcessor if you need to have more control over touch and
     *  mouse input. For example, you could filter the touches by overriding the "processTouches"
     *  method, throwing away any touches you're not interested in and passing the rest to the
     *  super implementation.&lt;/p&gt;
     *  
     *  &lt;p&gt;To use your custom TouchProcessor, assign it to the "Starling.touchProcessor"
     *  property.&lt;/p&gt;
     *  
     *  &lt;p&gt;Note that you should not dispatch TouchEvents yourself, since they are
     *  much more complex to handle than conventional events (e.g. it must be made sure that an
     *  object receives a TouchEvent only once, even if it's manipulated with several fingers).
     *  Always use the base implementation of "processTouches" to let them be dispatched. That
     *  said: you can always dispatch your own custom events, of course.&lt;/p&gt;
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">TouchProcessor</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mStage</span>:<span class="ActionScriptDefault_Text">Stage</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mRoot</span>:<span class="ActionScriptDefault_Text">DisplayObject</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mElapsedTime</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mTouchMarker</span>:<span class="ActionScriptDefault_Text">TouchMarker</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mLastTaps</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Touch</span><span class="ActionScriptBracket/Brace">&gt;</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mShiftDown</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mCtrlDown</span>:<span class="ActionScriptDefault_Text">Boolean</span>  <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mMultitapTime</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.3;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mMultitapDistance</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 25;
        
        <span class="ActionScriptASDoc">/** A vector of arrays with the arguments that were passed to the "enqueue"
         *  method (the oldest being at the end of the vector). */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mQueue</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">&gt;</span>;
        
        <span class="ActionScriptASDoc">/** The list of all currently active touches. */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mCurrentTouches</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Touch</span><span class="ActionScriptBracket/Brace">&gt;</span>;
        
        <span class="ActionScriptASDoc">/** Helper objects. */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sUpdatedTouches</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Touch</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptBracket/Brace">&lt;</span><span class="ActionScriptDefault_Text">Touch</span><span class="ActionScriptBracket/Brace">&gt;</span>[];
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sHoveringTouchData</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptBracket/Brace">&lt;</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">&gt;</span>[];
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sHelperPoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptASDoc">/** Creates a new TouchProcessor that will dispatch events to the given stage. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">TouchProcessor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage</span>:<span class="ActionScriptDefault_Text">Stage</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">mRoot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mStage</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">stage</span>;
            <span class="ActionScriptDefault_Text">mElapsedTime</span> <span class="ActionScriptOperator">=</span> 0.0;
            <span class="ActionScriptDefault_Text">mCurrentTouches</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptBracket/Brace">&lt;</span><span class="ActionScriptDefault_Text">Touch</span><span class="ActionScriptBracket/Brace">&gt;</span>[];
            <span class="ActionScriptDefault_Text">mQueue</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptBracket/Brace">&lt;</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">&gt;</span>[];
            <span class="ActionScriptDefault_Text">mLastTaps</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptBracket/Brace">&lt;</span><span class="ActionScriptDefault_Text">Touch</span><span class="ActionScriptBracket/Brace">&gt;</span>[];

            <span class="ActionScriptDefault_Text">mStage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">KeyboardEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">KEY_DOWN</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onKey</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">mStage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">KeyboardEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">KEY_UP</span><span class="ActionScriptOperator">,</span>   <span class="ActionScriptDefault_Text">onKey</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">monitorInterruptions</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/** Removes all event handlers on the stage and releases any acquired resources. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">monitorInterruptions</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">mStage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">KeyboardEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">KEY_DOWN</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onKey</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">mStage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">KeyboardEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">KEY_UP</span><span class="ActionScriptOperator">,</span>   <span class="ActionScriptDefault_Text">onKey</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mTouchMarker</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">mTouchMarker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Analyzes the current touch queue and processes the list of current touches, emptying
         *  the queue while doing so. This method is called by Starling once per frame. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">advanceTime</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">passedTime</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">touch</span>:<span class="ActionScriptDefault_Text">Touch</span>;
            
            <span class="ActionScriptDefault_Text">mElapsedTime</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">passedTime</span>;
            
            <span class="ActionScriptComment">// remove old taps
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mLastTaps</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">mLastTaps</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span>1; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&gt;=</span>0; <span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mElapsedTime</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">mLastTaps</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">timestamp</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">mMultitapTime</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">mLastTaps</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">splice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mQueue</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Set touches that were new or moving to phase 'stationary'.
</span>                <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">mCurrentTouches</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BEGAN</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOVED</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">STATIONARY</span>;

                <span class="ActionScriptComment">// analyze new touches, but each ID only once
</span>                <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mQueue</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span>
                      <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">containsTouchWithID</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sUpdatedTouches</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mQueue</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">mQueue</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">touchArgs</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mQueue</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">touch</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createOrUpdateTouch</span><span class="ActionScriptBracket/Brace">(</span>
                                <span class="ActionScriptDefault_Text">touchArgs</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">touchArgs</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">touchArgs</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">touchArgs</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span>
                                <span class="ActionScriptDefault_Text">touchArgs</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">touchArgs</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">touchArgs</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptDefault_Text">sUpdatedTouches</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sUpdatedTouches</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">touch</span>; <span class="ActionScriptComment">// avoiding 'push'
</span>                <span class="ActionScriptBracket/Brace">}</span>

                <span class="ActionScriptComment">// process the current set of touches (i.e. dispatch touch events)
</span>                <span class="ActionScriptDefault_Text">processTouches</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sUpdatedTouches</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mShiftDown</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mCtrlDown</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptComment">// remove ended touches
</span>                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">mCurrentTouches</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span>1; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&gt;=</span>0; <span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mCurrentTouches</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ENDED</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">mCurrentTouches</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">splice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">sUpdatedTouches</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Dispatches TouchEvents to the display objects that are affected by the list of
         *  given touches. Called internally by "advanceTime". To calculate updated targets,
         *  the method will call "hitTest" on the "root" object.
         *  
         *  @param touches:   a list of all touches that have changed just now.
         *  @param shiftDown: indicates if the shift key was down when the touches occurred.
         *  @param CtrlDown:  indicates if the ctrl or cmd key was down when the touches occurred.
         */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">processTouches</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touches</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Touch</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span>
                                          <span class="ActionScriptDefault_Text">shiftDown</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ctrlDown</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">sHoveringTouchData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptComment">// the same touch event will be dispatched to all targets;
</span>            <span class="ActionScriptComment">// the 'dispatch' method will make sure each bubble target is visited only once.
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">touchEvent</span>:<span class="ActionScriptDefault_Text">TouchEvent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">TouchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">TouchEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TOUCH</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mCurrentTouches</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">shiftDown</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ctrlDown</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">touch</span>:<span class="ActionScriptDefault_Text">Touch</span>;
            
            <span class="ActionScriptComment">// hit test our updated touches
</span>            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">touches</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// hovering touches need special handling (see below)
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">HOVER</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">sHoveringTouchData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sHoveringTouchData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">touch</span>: <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">,</span>
                        <span class="ActionScriptDefault_Text">target</span>: <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span><span class="ActionScriptOperator">,</span>
                        <span class="ActionScriptDefault_Text">bubbleChain</span>: <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bubbleChain</span>
                    <span class="ActionScriptBracket/Brace">}</span>; <span class="ActionScriptComment">// avoiding 'push'
</span>                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">HOVER</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BEGAN</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">sHelperPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalY</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mRoot</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hitTest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sHelperPoint</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// if the target of a hovering touch changed, we dispatch the event to the previous
</span>            <span class="ActionScriptComment">// target to notify it that it's no longer being hovered over.
</span>            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">touchData</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">sHoveringTouchData</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touchData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">touchData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">touchEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispatch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touchData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bubbleChain</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// dispatch events for the rest of our updated touches
</span>            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">touches</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touchEvent</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Enqueues a new touch our mouse event with the given properties. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">enqueue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touchID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">phase</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">globalX</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">globalY</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                                <span class="ActionScriptDefault_Text">pressure</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1.0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">width</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1.0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">height</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1.0<span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">mQueue</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">unshift</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arguments</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// multitouch simulation (only with mouse)
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mCtrlDown</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">simulateMultitouch</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">touchID</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">mTouchMarker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">moveMarker</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">globalX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">globalY</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mShiftDown</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">mQueue</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">unshift</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">phase</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mTouchMarker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mockX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mTouchMarker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mockY</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Enqueues an artificial touch that represents the mouse leaving the stage.
         *  
         *  &lt;p&gt;On OS X, we get mouse events from outside the stage; on Windows, we do not.
         *  This method enqueues an artificial hover point that is just outside the stage.
         *  That way, objects listening for HOVERs over them will get notified everywhere.&lt;/p&gt;
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">enqueueMouseLeftStage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mouse</span>:<span class="ActionScriptDefault_Text">Touch</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getCurrentTouch</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mouse</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">mouse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">HOVER</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">offset</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 1;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">exitX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mouse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalX</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">exitY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mouse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalY</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">distLeft</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mouse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalX</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">distRight</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mStage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageWidth</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">distLeft</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">distTop</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mouse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalY</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">distBottom</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mStage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageHeight</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">distTop</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">minDist</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">min</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">distLeft</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">distRight</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">distTop</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">distBottom</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// the new hover point should be just outside the stage, near the point where
</span>            <span class="ActionScriptComment">// the mouse point was last to be seen.
</span>            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">minDist</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">distLeft</span><span class="ActionScriptBracket/Brace">)</span>       <span class="ActionScriptDefault_Text">exitX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">offset</span>;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">minDist</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">distRight</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">exitX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mStage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageWidth</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">offset</span>;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">minDist</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">distTop</span><span class="ActionScriptBracket/Brace">)</span>   <span class="ActionScriptDefault_Text">exitY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">offset</span>;
            <span class="ActionScriptReserved">else</span>                           <span class="ActionScriptDefault_Text">exitY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mStage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageHeight</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">offset</span>;
            
            <span class="ActionScriptDefault_Text">enqueue</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">HOVER</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">exitX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">exitY</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createOrUpdateTouch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touchID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">phase</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">,</span>
                                             <span class="ActionScriptDefault_Text">globalX</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">globalY</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                                             <span class="ActionScriptDefault_Text">pressure</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1.0<span class="ActionScriptOperator">,</span>
                                             <span class="ActionScriptDefault_Text">width</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1.0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">height</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1.0<span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Touch</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">touch</span>:<span class="ActionScriptDefault_Text">Touch</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getCurrentTouch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touchID</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">touch</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Touch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touchID</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">addCurrentTouch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">globalX</span>;
            <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">globalY</span>;
            <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">phase</span>;
            <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">timestamp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mElapsedTime</span>;
            <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pressure</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pressure</span>;
            <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span>  <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">width</span>;
            <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">height</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BEGAN</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">updateTapCount</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">touch</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">updateTapCount</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span>:<span class="ActionScriptDefault_Text">Touch</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nearbyTap</span>:<span class="ActionScriptDefault_Text">Touch</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">minSqDist</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mMultitapDistance</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">mMultitapDistance</span>;
            
            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tap</span>:<span class="ActionScriptDefault_Text">Touch</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">mLastTaps</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sqDist</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tap</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalX</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalX</span><span class="ActionScriptOperator">,</span> 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span>
                                    <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tap</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalY</span><span class="ActionScriptOperator">,</span> 2<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sqDist</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptDefault_Text">minSqDist</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">nearbyTap</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tap</span>;
                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nearbyTap</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tapCount</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">nearbyTap</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tapCount</span> <span class="ActionScriptOperator">+</span> 1;
                <span class="ActionScriptDefault_Text">mLastTaps</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">splice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mLastTaps</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nearbyTap</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tapCount</span> <span class="ActionScriptOperator">=</span> 1;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">mLastTaps</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addCurrentTouch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span>:<span class="ActionScriptDefault_Text">Touch</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">mCurrentTouches</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span>1; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&gt;=</span>0; <span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mCurrentTouches</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">mCurrentTouches</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">splice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">mCurrentTouches</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getCurrentTouch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touchID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Touch</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">touch</span>:<span class="ActionScriptDefault_Text">Touch</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">mCurrentTouches</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">touchID</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">touch</span>;
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">containsTouchWithID</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touches</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Touch</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">touchID</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">touch</span>:<span class="ActionScriptDefault_Text">Touch</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">touches</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">touchID</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Indicates if it multitouch simulation should be activated. When the user presses
         *  ctrl/cmd (and optionally shift), he'll see a second touch curser that mimics the first.
         *  That's an easy way to develop and test multitouch when there's only a mouse available.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">simulateMultitouch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mTouchMarker</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span>; <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">simulateMultitouch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span> 
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">simulateMultitouch</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span>; <span class="ActionScriptComment">// no change
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">mTouchMarker</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">TouchMarker</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">mTouchMarker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptDefault_Text">mStage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mTouchMarker</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>                
                <span class="ActionScriptDefault_Text">mTouchMarker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFromParent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">mTouchMarker</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** The time period (in seconds) in which two touches must occur to be recognized as
         *  a multitap gesture. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">multitapTime</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mMultitapTime</span>; <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">multitapTime</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptDefault_Text">mMultitapTime</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>; <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** The distance (in points) describing how close two touches must be to each other to
         *  be recognized as a multitap gesture. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">multitapDistance</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mMultitapDistance</span>; <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">multitapDistance</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptDefault_Text">mMultitapDistance</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>; <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/** The base object that will be used for hit testing. Per default, this reference points
         *  to the stage; however, you can limit touch processing to certain parts of your game
         *  by assigning a different object. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">root</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">DisplayObject</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mRoot</span>; <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">root</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">DisplayObject</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptDefault_Text">mRoot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>; <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** The stage object to which the touch objects are (per default) dispatched. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">stage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Stage</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mStage</span>; <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Returns the number of fingers / touch points that are currently on the stage. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">numCurrentTouches</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mCurrentTouches</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptComment">// keyboard handling
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onKey</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">KeyboardEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">keyCode</span> <span class="ActionScriptOperator">==</span> 17 <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">keyCode</span> <span class="ActionScriptOperator">==</span> 15<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptComment">// ctrl or cmd key
</span>            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">wasCtrlDown</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mCtrlDown</span>;
                <span class="ActionScriptDefault_Text">mCtrlDown</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">KeyboardEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">KEY_DOWN</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">simulateMultitouch</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">wasCtrlDown</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">mCtrlDown</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">mTouchMarker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mCtrlDown</span>;
                    <span class="ActionScriptDefault_Text">mTouchMarker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">moveCenter</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mStage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageWidth</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mStage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageHeight</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mouseTouch</span>:<span class="ActionScriptDefault_Text">Touch</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getCurrentTouch</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mockedTouch</span>:<span class="ActionScriptDefault_Text">Touch</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getCurrentTouch</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mouseTouch</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">mTouchMarker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">moveMarker</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mouseTouch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mouseTouch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalY</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">wasCtrlDown</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">mockedTouch</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">mockedTouch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ENDED</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// end active touch ...
</span>                        <span class="ActionScriptDefault_Text">mQueue</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">unshift</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ENDED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mockedTouch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mockedTouch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalY</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mCtrlDown</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">mouseTouch</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// ... or start new one
</span>                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mouseTouch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">HOVER</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">mouseTouch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ENDED</span><span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptDefault_Text">mQueue</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">unshift</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">HOVER</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mTouchMarker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mockX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mTouchMarker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mockY</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">else</span>
                            <span class="ActionScriptDefault_Text">mQueue</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">unshift</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BEGAN</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mTouchMarker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mockX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mTouchMarker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mockY</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">keyCode</span> <span class="ActionScriptOperator">==</span> 16<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptComment">// shift key
</span>            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">mShiftDown</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">KeyboardEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">KEY_DOWN</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptComment">// interruption handling
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">monitorInterruptions</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">enable</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// if the application moves into the background or is interrupted (e.g. through
</span>            <span class="ActionScriptComment">// an incoming phone call), we need to abort all touches.
</span>            
            <span class="ActionScriptReserved">try</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nativeAppClass</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getDefinitionByName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"flash.desktop::NativeApplication"</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nativeApp</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">nativeAppClass</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"nativeApplication"</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">enable</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">nativeApp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"deactivate"</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onInterruption</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptDefault_Text">nativeApp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"deactivate"</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onInterruption</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">catch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>:<span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">)</span> {} <span class="ActionScriptComment">// we're not running in AIR
</span>        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onInterruption</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mCurrentTouches</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// abort touches
</span>                <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">touch</span>:<span class="ActionScriptDefault_Text">Touch</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">mCurrentTouches</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BEGAN</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOVED</span> <span class="ActionScriptOperator">||</span>
                        <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">STATIONARY</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">touch</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">phase</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">TouchPhase</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ENDED</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>

                <span class="ActionScriptComment">// dispatch events
</span>                <span class="ActionScriptDefault_Text">processTouches</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mCurrentTouches</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mShiftDown</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mCtrlDown</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptComment">// purge touches
</span>            <span class="ActionScriptDefault_Text">mCurrentTouches</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">mQueue</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
