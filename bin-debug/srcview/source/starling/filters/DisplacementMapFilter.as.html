<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>DisplacementMapFilter.as</title>
<link rel="stylesheet" type="text/css" href="../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">// =================================================================================================
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">//    Starling Framework
</span><span class="ActionScriptComment">//    Copyright 2013 Gamua OG. All Rights Reserved.
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">//    This program is free software. You can redistribute and/or modify it
</span><span class="ActionScriptComment">//    in accordance with the terms of the accompanying license agreement.
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">// =================================================================================================
</span>
<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">filters</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BitmapDataChannel</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Context3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Context3DProgramType</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Context3DTextureFormat</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Context3DVertexBufferFormat</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Program3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">VertexBuffer3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Matrix3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Point</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RenderSupport</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Starling</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">textures</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Texture</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">formatString</span>;
    
    <span class="ActionScriptASDoc">/** The DisplacementMapFilter class uses the pixel values from the specified texture (called
     *  the displacement map) to perform a displacement of an object. You can use this filter 
     *  to apply a warped or mottled effect to any object that inherits from the DisplayObject 
     *  class. 
     *
     *  &lt;p&gt;The filter uses the following formula:&lt;/p&gt;
     *  &lt;listing&gt;dstPixel[x, y] = srcPixel[x + ((componentX(x, y) - 128) &amp;#42; scaleX) / 256, 
     *                      y + ((componentY(x, y) - 128) &amp;#42; scaleY) / 256]
     *  &lt;/listing&gt;
     *  
     *  &lt;p&gt;Where &lt;code&gt;componentX(x, y)&lt;/code&gt; gets the componentX property color value from the 
     *  map texture at &lt;code&gt;(x - mapPoint.x, y - mapPoint.y)&lt;/code&gt;.&lt;/p&gt;
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">DisplacementMapFilter</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">FragmentFilter</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mMapTexture</span>:<span class="ActionScriptDefault_Text">Texture</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mMapPoint</span>:<span class="ActionScriptDefault_Text">Point</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mComponentX</span>:<span class="ActionScriptDefault_Text">uint</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mComponentY</span>:<span class="ActionScriptDefault_Text">uint</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mScaleX</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mScaleY</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mRepeat</span>:<span class="ActionScriptDefault_Text">Boolean</span>;
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mShaderProgram</span>:<span class="ActionScriptDefault_Text">Program3D</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mMapTexCoordBuffer</span>:<span class="ActionScriptDefault_Text">VertexBuffer3D</span>;
        
        <span class="ActionScriptASDoc">/** Helper objects */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sOneHalf</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptBracket/Brace">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">[</span>0.5<span class="ActionScriptOperator">,</span> 0.5<span class="ActionScriptOperator">,</span> 0.5<span class="ActionScriptOperator">,</span> 0.5<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sMapTexCoords</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptBracket/Brace">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 1<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 1<span class="ActionScriptOperator">,</span> 1<span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sMatrix</span>:<span class="ActionScriptDefault_Text">Matrix3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sMatrixData</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> 
            <span class="ActionScriptReserved">new</span> <span class="ActionScriptBracket/Brace">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span>  0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span>  0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span>  0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptBracket/Brace">]</span>;
        
        <span class="ActionScriptASDoc">/** Creates a new displacement map filter that uses the provided map texture. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">DisplacementMapFilter</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mapTexture</span>:<span class="ActionScriptDefault_Text">Texture</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mapPoint</span>:<span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> 
                                              <span class="ActionScriptDefault_Text">componentX</span>:<span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptOperator">=</span>0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">componentY</span>:<span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptOperator">=</span>0<span class="ActionScriptOperator">,</span> 
                                              <span class="ActionScriptDefault_Text">scaleX</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>0.0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">scaleY</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>0.0<span class="ActionScriptOperator">,</span>
                                              <span class="ActionScriptDefault_Text">repeat</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">mMapTexture</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mapTexture</span>;
            <span class="ActionScriptDefault_Text">mMapPoint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">mComponentX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">componentX</span>;
            <span class="ActionScriptDefault_Text">mComponentY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">componentY</span>;
            <span class="ActionScriptDefault_Text">mScaleX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">scaleX</span>;
            <span class="ActionScriptDefault_Text">mScaleY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">scaleY</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mapPoint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mapPoint</span>;
            
            <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** @inheritDoc */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mMapTexCoordBuffer</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">mMapTexCoordBuffer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** @private */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createPrograms</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// the texture coordinates for the map texture are uploaded via a separate buffer
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mMapTexCoordBuffer</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">mMapTexCoordBuffer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">mMapTexCoordBuffer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">createVertexBuffer</span><span class="ActionScriptBracket/Brace">(</span>4<span class="ActionScriptOperator">,</span> 2<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">target</span>:<span class="ActionScriptDefault_Text">Starling</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">current</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mapFlags</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">RenderSupport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getTextureLookupFlags</span><span class="ActionScriptBracket/Brace">(</span>
                                      <span class="ActionScriptDefault_Text">mapTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">format</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mapTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mipMapping</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mapTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">repeat</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">inputFlags</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">RenderSupport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getTextureLookupFlags</span><span class="ActionScriptBracket/Brace">(</span>
                                        <span class="ActionScriptDefault_Text">Context3DTextureFormat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BGRA</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mRepeat</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">programName</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">formatString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"DMF_m{0}_i{1}"</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mapFlags</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">inputFlags</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">target</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">programName</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">mShaderProgram</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">target</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">programName</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// vc0-3: mvpMatrix
</span>                <span class="ActionScriptComment">// va0:   vertex position
</span>                <span class="ActionScriptComment">// va1:   input texture coords
</span>                <span class="ActionScriptComment">// va2:   map texture coords
</span>                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vertexShader</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>
                    <span class="ActionScriptString">"m44  op, va0, vc0"</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptComment">// 4x4 matrix transform to output space
</span>                    <span class="ActionScriptString">"mov  v0, va1"</span><span class="ActionScriptOperator">,</span>      <span class="ActionScriptComment">// pass input texture coordinates to fragment program
</span>                    <span class="ActionScriptString">"mov  v1, va2"</span>       <span class="ActionScriptComment">// pass map texture coordinates to fragment program
</span>                <span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"\n"</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">// v0:    input texCoords
</span>                <span class="ActionScriptComment">// v1:    map texCoords
</span>                <span class="ActionScriptComment">// fc0:   OneHalf
</span>                <span class="ActionScriptComment">// fc1-4: matrix
</span>                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fragmentShader</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>
                    <span class="ActionScriptString">"tex ft0,  v1, fs1 "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">mapFlags</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptComment">// read map texture
</span>                    <span class="ActionScriptString">"sub ft1, ft0, fc0"</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptComment">// subtract 0.5 -&gt; range [-0.5, 0.5]
</span>                    <span class="ActionScriptString">"m44 ft2, ft1, fc1"</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptComment">// multiply matrix with displacement values
</span>                    <span class="ActionScriptString">"add ft3,  v0, ft2"</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptComment">// add displacement values to texture coords
</span>                    <span class="ActionScriptString">"tex  oc, ft3, fs0 "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">inputFlags</span> <span class="ActionScriptComment">// read input texture at displaced coords
</span>                <span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"\n"</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">mShaderProgram</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">target</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">registerProgramFromSource</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">programName</span><span class="ActionScriptOperator">,</span> 
                    <span class="ActionScriptDefault_Text">vertexShader</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">fragmentShader</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** @private */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">activate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pass</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">context</span>:<span class="ActionScriptDefault_Text">Context3D</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">texture</span>:<span class="ActionScriptDefault_Text">Texture</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// already set by super class:
</span>            <span class="ActionScriptComment">//
</span>            <span class="ActionScriptComment">// vertex constants 0-3: mvpMatrix (3D)
</span>            <span class="ActionScriptComment">// vertex attribute 0:   vertex position (FLOAT_2)
</span>            <span class="ActionScriptComment">// vertex attribute 1:   texture coordinates (FLOAT_2)
</span>            <span class="ActionScriptComment">// texture 0:            input texture
</span>
            <span class="ActionScriptDefault_Text">updateParameters</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">texture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nativeWidth</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">texture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nativeHeight</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setVertexBufferAt</span><span class="ActionScriptBracket/Brace">(</span>2<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mMapTexCoordBuffer</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">Context3DVertexBufferFormat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FLOAT_2</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setProgramConstantsFromVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Context3DProgramType</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FRAGMENT</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">sOneHalf</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setProgramConstantsFromMatrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Context3DProgramType</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FRAGMENT</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">sMatrix</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setTextureAt</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mMapTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">base</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mShaderProgram</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** @private */</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">deactivate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pass</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">context</span>:<span class="ActionScriptDefault_Text">Context3D</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">texture</span>:<span class="ActionScriptDefault_Text">Texture</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setVertexBufferAt</span><span class="ActionScriptBracket/Brace">(</span>2<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setTextureAt</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">updateParameters</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">textureWidth</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">textureHeight</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// matrix:
</span>            <span class="ActionScriptComment">// Maps RGBA values of map texture to UV-offsets in input texture.
</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">scale</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Starling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">contentScaleFactor</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">columnX</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">columnY</span>:<span class="ActionScriptDefault_Text">int</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span>16; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">sMatrixData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptReserved">if</span>      <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mComponentX</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">BitmapDataChannel</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RED</span><span class="ActionScriptBracket/Brace">)</span>   <span class="ActionScriptDefault_Text">columnX</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mComponentX</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">BitmapDataChannel</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GREEN</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">columnX</span> <span class="ActionScriptOperator">=</span> 1;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mComponentX</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">BitmapDataChannel</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BLUE</span><span class="ActionScriptBracket/Brace">)</span>  <span class="ActionScriptDefault_Text">columnX</span> <span class="ActionScriptOperator">=</span> 2;
            <span class="ActionScriptReserved">else</span>                                             <span class="ActionScriptDefault_Text">columnX</span> <span class="ActionScriptOperator">=</span> 3;
            
            <span class="ActionScriptReserved">if</span>      <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mComponentY</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">BitmapDataChannel</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RED</span><span class="ActionScriptBracket/Brace">)</span>   <span class="ActionScriptDefault_Text">columnY</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mComponentY</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">BitmapDataChannel</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GREEN</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">columnY</span> <span class="ActionScriptOperator">=</span> 1;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mComponentY</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">BitmapDataChannel</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BLUE</span><span class="ActionScriptBracket/Brace">)</span>  <span class="ActionScriptDefault_Text">columnY</span> <span class="ActionScriptOperator">=</span> 2;
            <span class="ActionScriptReserved">else</span>                                             <span class="ActionScriptDefault_Text">columnY</span> <span class="ActionScriptOperator">=</span> 3;
            
            <span class="ActionScriptDefault_Text">sMatrixData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">columnX</span> <span class="ActionScriptOperator">*</span> 4    <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mScaleX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">scale</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">textureWidth</span>;
            <span class="ActionScriptDefault_Text">sMatrixData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">columnY</span> <span class="ActionScriptOperator">*</span> 4 <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mScaleY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">scale</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">textureHeight</span>;
            
            <span class="ActionScriptDefault_Text">sMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">copyRawDataFrom</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sMatrixData</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// vertex buffer: (containing map texture coordinates)
</span>            <span class="ActionScriptComment">// The size of input texture and map texture may be different. We need to calculate
</span>            <span class="ActionScriptComment">// the right values for the texture coordinates at the filter vertices.
</span>            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mapX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mMapPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>   <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">mapTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mapY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mMapPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>   <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">mapTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">maxU</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">textureWidth</span>  <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">mapTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nativeWidth</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">maxV</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">textureHeight</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">mapTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nativeHeight</span>;
            
            <span class="ActionScriptDefault_Text">sMapTexCoords</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">mapX</span>;        <span class="ActionScriptDefault_Text">sMapTexCoords</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">mapY</span>;
            <span class="ActionScriptDefault_Text">sMapTexCoords</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">mapX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">maxU</span>; <span class="ActionScriptDefault_Text">sMapTexCoords</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">mapY</span>;
            <span class="ActionScriptDefault_Text">sMapTexCoords</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">mapX</span>;        <span class="ActionScriptDefault_Text">sMapTexCoords</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">mapY</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">maxV</span>;
            <span class="ActionScriptDefault_Text">sMapTexCoords</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">mapX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">maxU</span>; <span class="ActionScriptDefault_Text">sMapTexCoords</span><span class="ActionScriptBracket/Brace">[</span>7<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">mapY</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">maxV</span>;
            
            <span class="ActionScriptDefault_Text">mMapTexture</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">adjustTexCoords</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sMapTexCoords</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">mMapTexCoordBuffer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">uploadFromVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sMapTexCoords</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 4<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// properties
</span>
        <span class="ActionScriptASDoc">/** Describes which color channel to use in the map image to displace the x result. 
         *  Possible values are constants from the BitmapDataChannel class. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">componentX</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mComponentX</span>; <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">componentX</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptDefault_Text">mComponentX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>; <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/** Describes which color channel to use in the map image to displace the y result. 
         *  Possible values are constants from the BitmapDataChannel class. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">componentY</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mComponentY</span>; <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">componentY</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptDefault_Text">mComponentY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>; <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/** The multiplier used to scale the x displacement result from the map calculation. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mScaleX</span>; <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptDefault_Text">mScaleX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>; <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/** The multiplier used to scale the y displacement result from the map calculation. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mScaleY</span>; <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptDefault_Text">mScaleY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>; <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** The texture that will be used to calculate displacement. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">mapTexture</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Texture</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mMapTexture</span>; <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">mapTexture</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Texture</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mMapTexture</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">mMapTexture</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
                <span class="ActionScriptDefault_Text">createPrograms</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** A value that contains the offset of the upper-left corner of the target display 
         *  object from the upper-left corner of the map image. */</span>   
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">mapPoint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mMapPoint</span>; <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">mapPoint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">mMapPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptDefault_Text">mMapPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setTo</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Indicates how the pixels at the edge of the input image (the filtered object) will
         *  be wrapped at the edge. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">repeat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mRepeat</span>; <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">repeat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> 
        <span class="ActionScriptBracket/Brace">{</span> 
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mRepeat</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">mRepeat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
                <span class="ActionScriptDefault_Text">createPrograms</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
